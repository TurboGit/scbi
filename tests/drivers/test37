RUNS ./scbi test37

CLEAN-DIFF <<EOF
xxxx/xx/xx xx:xx:xx : Building test37 [default] (master)
xxxx/xx/xx xx:xx:xx : native x86_64-linux-gnu
xxxx/xx/xx xx:xx:xx : steps : setup config build install wrapup
xxxx/xx/xx xx:xx:xx : no sources (vcs or tar)
xxxx/xx/xx xx:xx:xx : setup starting
xxxx/xx/xx xx:xx:xx : setup completed
xxxx/xx/xx xx:xx:xx : config starting
xxxx/xx/xx xx:xx:xx : config completed
xxxx/xx/xx xx:xx:xx : build starting
xxxx/xx/xx xx:xx:xx : build completed
xxxx/xx/xx xx:xx:xx : install starting
xxxx/xx/xx xx:xx:xx : install completed
xxxx/xx/xx xx:xx:xx : End Building test37 [default] (master)
EOF

RUNS cat .root/builds/.logs/*test37*config.log

DIFF <<EOF
in config (overriding)
# ROOT_DIR /this/is/it
# ABC_ROOT /perfect/here
# PATH     /var:/tmp:/bin:/usr/bin
# CONF17   two:one
EOF

RUNS cat .root/builds/.logs/*test37*build.log

DIFF <<EOF
in build
ROOT_DIR /this/is/it
ABC_ROOT /perfect/here
PATH     /var:/tmp:/bin:/usr/bin
CONF17   two:one
EOF

RUNS cat .root/builds/.logs/*test37*install.log

DIFF <<EOF
in install (overriding)
EOF

function add-to-var()
{
    local VAR=$1
    local DIR=$2

    if [[ $VAR != PATH ]]; then
        echo $VAR $DIR
    fi
}
declare -fx add-to-var

RUNS source .root/builds/test37/build/.log/env.cmd

DIFF <<EOF
ROOT_DIR /this/is/it
ABC_ROOT /perfect/here
CONF17 one
CONF17 two
EOF

# check out of tree build
NOK -h .root/builds/test37/build/build
