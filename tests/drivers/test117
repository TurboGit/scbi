
REP=$PWD/.root/builds/metaagg/x86_64-linux-gnu-default/install
LDIR=$PWD/.root/builds/usemetaagg/x86_64-linux-gnu-default/logs

RUNS ./scbi metaagg

CLEAN-DIFF <<EOF
2024/03/29 09:56:59 : Metamodule metaagg [default] setup
2024/03/29 09:56:59 : End metamodule metaagg [default] setup

2024/03/29 09:56:59 : Building lib1 [default] (master)
2024/03/29 09:56:59 : native x86_64-linux-gnu
2024/03/29 09:56:59 : steps : setup config build install wrapup
2024/03/29 09:56:59 : get sources from git
2024/03/29 09:56:59 : apply-patch filename lib1-0-fix.patch
2024/03/29 09:56:59 : build starting
2024/03/29 09:56:59 : build completed
2024/03/29 09:56:59 : install starting
2024/03/29 09:56:59 : install completed
2024/03/29 09:56:59 : copy install into <sandbox>/install
2024/03/29 09:56:59 : End Building lib1 [default] (master)

2024/03/29 09:56:59 : Building libenv [default] (master)
2024/03/29 09:56:59 : native x86_64-linux-gnu
2024/03/29 09:56:59 : steps : setup config build install wrapup
2024/03/29 09:57:00 : get sources from git
2024/03/29 09:57:00 : config starting
2024/03/29 09:57:00 : config completed
2024/03/29 09:57:00 : build starting
2024/03/29 09:57:00 : build completed
2024/03/29 09:57:00 : install starting
2024/03/29 09:57:00 : install completed
2024/03/29 09:57:00 : copy install into <sandbox>/install
2024/03/29 09:57:00 : End Building libenv [default] (master)

2024/03/29 09:57:00 : Metamodule metaagg [default] wrapup
2024/03/29 09:57:00 : End metamodule metaagg [default] wrapup
EOF

OK -d $REP

OK -f $REP/include/lib1.h
OK -f $REP/include/lib2.h
OK -f $REP/lib/liblib1.so
OK -f $REP/lib/liblib2.so

RUNS ./scbi usemetaagg

CLEAN-DIFF <<EOF
xxxx/xx/xx xx:xx:xx : Building usemetaagg [default] (master)
xxxx/xx/xx xx:xx:xx : native x86_64-linux-gnu
xxxx/xx/xx xx:xx:xx : steps : setup config build install wrapup
xxxx/xx/xx xx:xx:xx : get sources from git
xxxx/xx/xx xx:xx:xx : build starting
xxxx/xx/xx xx:xx:xx : build completed
xxxx/xx/xx xx:xx:xx : install starting
xxxx/xx/xx xx:xx:xx : install completed
xxxx/xx/xx xx:xx:xx : copy install into <sandbox>/install
xxxx/xx/xx xx:xx:xx : End Building usemetaagg [default] (master)
EOF

RUNS ./scbi --tests:only usemetaagg

CLEAN-DIFF <<EOF
xxxx/xx/xx xx:xx:xx : Building usemetaagg [default] (master)
xxxx/xx/xx xx:xx:xx : native x86_64-linux-gnu
xxxx/xx/xx xx:xx:xx : steps : tests
xxxx/xx/xx xx:xx:xx : no build needed, versions match
xxxx/xx/xx xx:xx:xx : tests starting
main on master
liba.C patched version
xxxx/xx/xx xx:xx:xx : tests completed
xxxx/xx/xx xx:xx:xx : End Building usemetaagg [default] (master)
EOF

#  Check that there is PATH to the aggregate module but not to the
#  aggregated ones.
GREP "/builds/metaagg/" $LDIR/env.cmd
NGREP "/builds/lib1/" $LDIR/env.cmd
NGREP "/builds/libenv/" $LDIR/env.cmd
