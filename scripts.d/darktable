
function darktable-vcs()
{
    echo default
    echo none
    echo git
    echo http://github.com/darktable-org/darktable.git
}

function darktable-out-of-tree()
{
    echo true
}

function darktable-depends()
{
    echo libsqlite3-dev
    echo libpng-dev
    echo libjpeg-dev
    echo libpugixml-dev
    echo libxml2-dev
    echo liblcms2-dev
    echo libtiff-dev
    echo libexiv2-dev
    echo libcurl4
    echo libgphoto2-dev
    echo libopenexr-dev
    echo libsoup2.4-dev
    echo liblua5.3-dev
    echo libosmgpsmap-1.0-dev
    echo libgraphicsmagick1-dev
    echo libcolord-dev
    echo libgomp1
    echo libgmic-dev
    echo libcups-dev
}

function darktable-env()
{
    system-compiler
    add-to-var PERL5LIB .
}

function darktable-clang-config()
{
    local PREFIX=$1
    local TARGET=$2

    CLANG_VER=8

    # fake build script which want the src dir to be a git repository

    if [ ! -h ../src/.git ]; then
        ln -s ../../src/.git ../src/.git
    fi

    CC=clang-$CLANG_VER CXX=clang++-$CLANG_VER cmake \
      -DCMAKE_BUILD_TYPE=RelWithDebInfo -DUSE_OPENMP=OFF $GPOPTS \
      -DCMAKE_INSTALL_PREFIX=$PREFIX \
      ../src
}

function darktable-release-config()
{
    local PREFIX=$1
    local TARGET=$2

    # fake build script which want the src dir to be a git repository

    if [ ! -h ../src/.git ]; then
        ln -s ../../src/.git ../src/.git
    fi

    cmake -DCMAKE_BUILD_TYPE=Release $GPOPTS \
          -DCMAKE_INSTALL_PREFIX=$PREFIX \
          ../src
}

function darktable-config()
{
    local PREFIX=$1
    local TARGET=$2

    # fake build script which want the src dir to be a git repository

    if [ ! -h ../src/.git ]; then
        ln -s ../../src/.git ../src/.git
    fi

    if [ -d "$GINST" ]; then
        GPOPTS="-DGPHOTO2CONFIG_EXECUTABLE=$GINST/bin/gphoto2-config \
        -DGPHOTO2_INCLUDE_DIR=$GINST/include \
        -DGPHOTO2_LIBRARY=$GINST/lib/libgphoto2.so \
        -DGPHOTO2_PORT_LIBRARY=$GINST/lib/libgphoto2_port.so"
    fi

    if [ -d "$LINST" ]; then
       GPOPTS="$GOPT -DLENSFUN_INCLUDE_DIR=$LINST/include/lensfun \
        -DLENSFUN_LIBRARY=$LINST/lib/liblensfun.so.1"
    fi

    cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo $GPOPTS \
          -DCMAKE_INSTALL_PREFIX=$PREFIX \
          ../src
}

function darktable-build()
{
    local PREFIX=$1
    local TARGET=$2

    make -j4
}

function darktable-install()
{
    local PREFIX=$1
    local TARGET=$2

    make install

    rm -f ../src/.git
}

function darktable-prefix()
{
    echo /opt/darktable
}
