
function darktable-vcs()
{
    echo default
    echo none
    echo git
    echo https://github.com/darktable-org/darktable.git
}

function darktable-out-of-tree()
{
    echo true
}

function darktable-build-depends()
{
    echo os@-cmake
    echo os@-python3-jsonschema
    echo os@-intltool
    echo os@-xsltproc
    echo os@-findbin
}

function darktable-clang-build-depends()
{
    echo os@-llvm-10
    echo os@-clang-10
}

function darktable-depends()
{
    echo os@-sqlite3-dev
    echo os@-png-dev
    echo os@-jpeg-dev
    echo os@-openjp2-dev
    echo os@-pugixml-dev
    echo os@-xml2-dev
    echo os@-lcms2-dev
    echo os@-tiff-dev
    echo os@-exiv2-dev
    echo os@-curl4
    echo os@-curl4-gnutls-dev
    echo os@-gphoto2-dev
    echo os@-openexr-dev
    echo os@-soup2-dev
    echo os@-lua5.4-dev
    echo os@-osmgpsmap-1.0-dev
    echo os@-graphicsmagick1-dev
    echo os@-colord-dev
    echo os@-colord-gtk-dev
    echo os@-gomp1
    echo os@-gmic-dev
    echo os@-cups2-dev
    echo os@-secret-dev
    echo os@-xml2-utils
    echo os@-lensfun-dev
    echo os@-rsvg2-dev
    echo os@-json-glib-dev
    echo os@-pod-parser-perl
    echo os@-avif-dev
    echo os@-webp-dev
    echo os@-cairo-dev
    echo os@-image-exiftool-perl
}

function darktable-clang-build-env()
{
    add-to-var CC  clang-$CLANG_VER
    add-to-var CXX clang++-$CLANG_VER
}

function darktable-env()
{
    system-compiler
    add-to-var PERL5LIB .
}

function darktable-release-config-options()
{
    local PREFIX=$1
    local TARGET=$2
    local VARIANT=$3

    echo -DCMAKE_BUILD_TYPE=Release
}

function darktable-default-config-options()
{
    local PREFIX=$1
    local TARGET=$2
    local VARIANT=$3

    echo -DCMAKE_BUILD_TYPE=RelWithDebInfo
}

function darktable-common-config-options()
{
    local PREFIX=$1
    local TARGET=$2
    local VARIANT=$3

    echo -DCMAKE_INSTALL_PREFIX=$PREFIX
}

function darktable-config()
{
    local PREFIX=$1
    local TARGET=$2
    local VARIANT=$3

    # fake build script which want the src dir to be a git repository

    if [[ ! -h ../src/.git ]]; then
        ln -s ../../src/.git ../src/.git
    fi

    local OPTIONS=$(get-config-options $PREFIX $TARGET $VARIANT)

    cmake $OPTIONS ../src
}

function darktable-build()
{
    local PREFIX=$1
    local TARGET=$2

    make -j$SCBI_HALF_JOBS
}

function darktable-install()
{
    local PREFIX=$1
    local TARGET=$2

    make install

    rm -f ../src/.git
}

function darktable-tests()
{
    local PREFIX=$1
    local TARGET=$2

    (
        cd ../src/src/tests/integration

        PATH=/opt/darktable/bin:$PATH ./run.sh
    )
}

function darktable-prefix()
{
    echo /opt/darktable
}
