
function darktable-update()
{
    PREFIX=$1
    TARGET=$2

    git_co git://darktable.git.sf.net/gitroot/darktable/darktable darktable

    cd $GREPO/darktable && git pull
}

function darktable-setup()
{
    PREFIX=$1
    TARGET=$2

    if [ ! -d src ]; then
        ln -s $GREPO/darktable src
    fi

    export PATH=/usr/bin:/bin:/usr/local/bin
    export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu
    dprefix=/opt/darktable

    mkdir -p $TARGET
}

function darktable-config()
{
    PREFIX=$1
    TARGET=$2

    # need GPHOTO2 2.5.3 to work properly with USB-3
    GINST=/opt/gphoto2/

    if [ -d $GINST ]; then
        GPOPTS="-DGPHOTO2CONFIG_EXECUTABLE=$GINST/bin/gphoto2-config \
        -DGPHOTO2_INCLUDE_DIR=$GINST/include \
        -DGPHOTO2_LIBRARY=$GINST/lib/libgphoto2.so \
        -DGPHOTO2_PORT_LIBRARY=$GINST/lib/libgphoto2_port.so"
    fi

    cd $TARGET && cmake ../src -DCMAKE_BUILD_TYPE=Release $GPOPTS \
	-DCMAKE_INSTALL_PREFIX=$dprefix \
	-DINSTALL_IOP_EXPERIMENTAL=On
}

function darktable-build()
{
    PREFIX=$1
    TARGET=$2

    cd $TARGET && make -j4
}

function darktable-install()
{
    PREFIX=$1
    TARGET=$2

    cd $TARGET && sudo make install
}
